<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Earn & Withdraw App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Monetag SDK -->
  <script src="//libtl.com/sdk.js" data-zone="9756703" data-sdk="show_9756703"></script>

  <style>
    body {font-family: 'Segoe UI', sans-serif; margin:0; background:#fafafa;}
    nav {display:flex;justify-content:space-around;position:fixed;bottom:0;width:100%;background:#ff4081;color:#fff;font-weight:bold;padding:10px 0;}
    nav div{cursor:pointer}
    .section{display:none;padding:20px;padding-bottom:80px}
    .section.active{display:block}
    .btn{padding:12px 20px;font-size:16px;background:linear-gradient(135deg,#ff6a88,#ff99ac);color:#fff;border:none;border-radius:12px;cursor:pointer;margin:8px}
    .btn:hover{opacity:.85}
    .card{background:#fff;padding:15px;margin:10px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
  </style>
</head>
<body>
  <header style="text-align:center;padding:15px;font-size:20px;color:#ff4081">💰 Earn & Withdraw</header>

  <!-- Home -->
  <div id="home" class="section active">
    <div class="card">
      <h3 id="userName">👤 User Name</h3>
      <p>📺 Ads Watched: <span id="totalAds">0</span></p>
      <p>💼 Balance: <span id="userBalance">0</span> pts</p>
      <button id="watchAdHome" class="btn">🎬 Watch Ads</button>
    </div>
  </div>

  <!-- Earn -->
  <div id="earn" class="section">
    <div class="card">
      <h3>🎯 Choose Ad Format</h3>
      <button id="btnInterstitial" class="btn">🎬 Rewarded Interstitial</button>
      <button id="btnPopup" class="btn">🎁 Rewarded Popup</button>
      <button id="btnInapp" class="btn">📺 In-app Interstitial</button>
      <p id="progressText">Ready...</p>
    </div>
  </div>

  <!-- Withdraw -->
  <div id="withdraw" class="section">
    <div class="card">
      <h3>💵 Withdraw</h3>
      <p>Balance: <b><span id="withdrawBalance">0</span> pts</b></p>
      <select id="method"><option>Bkash</option><option>Nagad</option><option>Rocket</option></select>
      <input type="number" id="amount" placeholder="Min 10 pts">
      <input type="text" id="number" placeholder="Your Number">
      <button id="submitWithdraw" class="btn">📤 Submit</button>
    </div>
  </div>

  <!-- History -->
  <div id="history" class="section">
    <div class="card">
      <h3>📜 Withdraw History</h3>
      <div id="withdrawLog"><p>No history yet.</p></div>
    </div>
  </div>

  <nav>
    <div onclick="switchSection('home')">🏠 Home</div>
    <div onclick="switchSection('earn')">🎯 Earn</div>
    <div onclick="switchSection('withdraw')">💵 Withdraw</div>
    <div onclick="switchSection('history')">📜 History</div>
  </nav>

<script>
Telegram.WebApp.ready();
const user=Telegram.WebApp.initDataUnsafe?.user;
const name=`${user?.first_name||'Unknown'} ${user?.last_name||''}`.trim();
document.getElementById("userName").textContent="👤 "+name;

let points=parseInt(localStorage.getItem('points'))||0;
let totalAds=parseInt(localStorage.getItem('totalAds'))||0;
let withdrawHistory=JSON.parse(localStorage.getItem('withdrawHistory')||'[]');

function updateUI(){
  document.getElementById("totalAds").textContent=totalAds;
  document.getElementById("userBalance").textContent=points;
  document.getElementById("withdrawBalance").textContent=points;
  let historyHTML=withdrawHistory.length?withdrawHistory.map(h=>`
  <div>
    <p>📅 ${h.date}</p>
    <p>💰 ${h.amount} pts</p>
    <p>📱 ${h.method} - ${h.number}</p>
  </div>`).join(''):'<p>No history yet.</p>';
  document.getElementById("withdrawLog").innerHTML=historyHTML;
}
updateUI();

function rewardUser(){
  points++; totalAds++;
  localStorage.setItem('points',points);
  localStorage.setItem('totalAds',totalAds);
  updateUI();
}

// Rewarded Interstitial
document.getElementById("btnInterstitial").onclick=()=>{
  if(typeof show_9756703!=="function") return alert("Ad not ready.");
  document.getElementById("progressText").textContent="🎬 Showing Interstitial...";
  show_9756703().then(()=>{
    rewardUser();
    document.getElementById("progressText").textContent="✅ Interstitial complete! +1 pt";
  });
};

// Rewarded Popup
document.getElementById("btnPopup").onclick=()=>{
  if(typeof show_9756703!=="function") return alert("Ad not ready.");
  document.getElementById("progressText").textContent="🎁 Showing Popup...";
  show_9756703('pop').then(()=>{
    rewardUser();
    document.getElementById("progressText").textContent="✅ Popup complete! +1 pt";
  }).catch(()=>{document.getElementById("progressText").textContent="❌ Popup error";});
};

// In-app Interstitial
document.getElementById("btnInapp").onclick=()=>{
  if(typeof show_9756703!=="function") return alert("Ad not ready.");
  document.getElementById("progressText").textContent="📺 Activating In-app Interstitial...";
  show_9756703({
    type:'inApp',
    inAppSettings:{
      frequency:2,
      capping:0.1,
      interval:30,
      timeout:5,
      everyPage:false
    }
  });
  rewardUser();
};

document.getElementById("watchAdHome").onclick=()=>switchSection('earn');

// Withdraw
document.getElementById("submitWithdraw").onclick=()=>{
  const m=document.getElementById('method').value;
  const a=parseInt(document.getElementById('amount').value);
  const n=document.getElementById('number').value.trim();
  if(!n||isNaN(a)||a<10||a>points) return alert("Invalid input");
  points-=a;
  withdrawHistory.unshift({date:new Date().toLocaleString(),amount:a,method:m,number:n});
  localStorage.setItem('points',points);
  localStorage.setItem('withdrawHistory',JSON.stringify(withdrawHistory));
  updateUI();
  alert("✅ Withdraw request saved!");
};

// Section Switch
function switchSection(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
</script>
</body>
</html>
